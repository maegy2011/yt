generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

model BlacklistAuditLog {
  id           String   @id
  action       String
  itemType     String
  itemId       String
  previousData String?
  newData      String?
  reason       String?
  userId       String?
  ipAddress    String?
  userAgent    String?
  createdAt    DateTime @default(now())

  @@index([userId])
  @@index([createdAt])
  @@index([itemId])
  @@index([itemType])
  @@index([action])
}

model BlacklistBatch {
  id           String   @id
  name         String?
  description  String?
  source       String
  itemCount    Int      @default(0)
  successCount Int      @default(0)
  errorCount   Int      @default(0)
  status       String   @default("pending")
  filePath     String?
  metadata     String?
  createdAt    DateTime @default(now())
  updatedAt    DateTime

  @@index([source])
  @@index([createdAt])
  @@index([status])
}

model BlacklistCategory {
  id               String             @id
  name             String             @unique
  color            String             @default("#ff0000")
  description      String?
  isActive         Boolean            @default(true)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  icon             String?
  priority         Int                @default(0)
  isSystem         Boolean            @default(false)
  itemCount        Int                @default(0)
  lastUsed         DateTime?
  BlacklistPattern BlacklistPattern[]
  BlacklistedItem  BlacklistedItem[]

  @@index([lastUsed])
  @@index([isSystem])
  @@index([isActive, priority])
  @@index([name])
}

model BlacklistMetrics {
  id            String   @id
  date          DateTime @unique @default(now())
  totalItems    Int      @default(0)
  videoCount    Int      @default(0)
  channelCount  Int      @default(0)
  playlistCount Int      @default(0)
  filterHits    Int      @default(0)
  avgFilterTime Float    @default(0)
  cacheHitRate  Float    @default(0)

  @@index([date])
}

model BlacklistOperation {
  id          String    @id
  operationId String    @unique
  action      String
  itemType    String
  itemId      String
  itemData    String
  isUndo      Boolean   @default(false)
  isRedo      Boolean   @default(false)
  userId      String?
  createdAt   DateTime  @default(now())
  appliedAt   DateTime?

  @@index([createdAt])
  @@index([userId])
  @@index([itemType])
  @@index([action])
  @@index([operationId])
}

model BlacklistPattern {
  id                String             @id
  pattern           String
  type              String
  patternType       String             @default("keyword")
  isActive          Boolean            @default(true)
  priority          Int                @default(0)
  matchCount        Int                @default(0)
  lastMatched       DateTime?
  createdAt         DateTime           @default(now())
  updatedAt         DateTime
  name              String?
  description       String?
  categoryId        String?
  severity          String             @default("medium")
  source            String             @default("manual")
  isCaseSensitive   Boolean            @default(false)
  isGlobal          Boolean            @default(false)
  matchThreshold    Int                @default(1)
  BlacklistCategory BlacklistCategory? @relation(fields: [categoryId], references: [id])

  @@index([source])
  @@index([lastMatched])
  @@index([matchCount])
  @@index([isGlobal, isActive])
  @@index([categoryId, isActive])
  @@index([severity, isActive])
  @@index([patternType, isActive])
  @@index([type, isActive, priority])
}

model BlacklistedItem {
  id                String             @id
  itemId            String             @unique
  title             String
  type              String
  thumbnail         String?
  channelName       String?
  addedAt           DateTime           @default(now())
  updatedAt         DateTime
  expiresAt         DateTime?
  isChannelBlock    Boolean            @default(false)
  priority          Int                @default(0)
  batchId           String?
  categoryId        String?
  severity          String             @default("medium")
  source            String             @default("manual")
  reason            String?
  tags              String?
  metadata          String?
  matchCount        Int                @default(0)
  lastMatched       DateTime?
  isActive          Boolean            @default(true)
  BlacklistCategory BlacklistCategory? @relation(fields: [categoryId], references: [id])

  @@unique([itemId, type])
  @@index([source])
  @@index([matchCount])
  @@index([lastMatched])
  @@index([addedAt])
  @@index([expiresAt])
  @@index([priority, isActive])
  @@index([severity, isActive])
  @@index([categoryId, isActive])
  @@index([isChannelBlock, isActive])
  @@index([type, isActive])
  @@index([itemId])
}

model ContentFilterCache {
  id         String   @id
  cacheKey   String   @unique
  itemType   String
  itemId     String
  result     String
  reason     String?
  matchedBy  String?
  matchedId  String?
  confidence Int      @default(0)
  expiresAt  DateTime
  createdAt  DateTime @default(now())
  updatedAt  DateTime

  @@index([confidence])
  @@index([matchedBy])
  @@index([result])
  @@index([expiresAt])
  @@index([itemType, itemId])
  @@index([cacheKey])
}

model FavoriteChannel {
  id              String   @id
  channelId       String   @unique
  name            String
  thumbnail       String
  subscriberCount String?
  videoCount      String?
  viewCount       String?
  addedAt         DateTime @default(now())
  updatedAt       DateTime

  @@index([channelId])
  @@index([name])
  @@index([addedAt])
}

model FavoritePlaylist {
  id              String   @id
  playlistId      String   @unique
  title           String
  channelName     String
  thumbnail       String
  videoCount      String
  addedAt         DateTime @default(now())
  updatedAt       DateTime

  @@index([playlistId])
  @@index([addedAt])
}

model FavoriteVideo {
  id          String   @id
  videoId     String   @unique
  title       String
  channelName String
  thumbnail   String
  duration    String?
  viewCount   String?
  addedAt     DateTime @default(now())
  updatedAt   DateTime

  @@index([addedAt, channelName])
  @@index([videoId])
  @@index([channelName])
  @@index([addedAt])
}

model FilteringMetrics {
  id                  String   @id
  date                DateTime @unique @default(now())
  totalRequests       Int      @default(0)
  blockedRequests     Int      @default(0)
  whitelistedRequests Int      @default(0)
  patternMatches      Int      @default(0)
  avgResponseTime     Float    @default(0)
  cacheHitRate        Float    @default(0)
  activeRules         Int      @default(0)
  systemLoad          Float    @default(0)

  @@index([date])
}

model NoteLink {
  id         String    @id
  noteId     String
  notebookId String
  createdAt  DateTime  @default(now())
  Notebook   Notebook  @relation(fields: [notebookId], references: [id], onDelete: Cascade)
  VideoNote  VideoNote @relation(fields: [noteId], references: [id], onDelete: Cascade)

  @@unique([noteId, notebookId])
  @@index([createdAt])
  @@index([notebookId])
  @@index([noteId])
}

model Notebook {
  id          String      @id
  title       String
  description String?
  color       String      @default("#3b82f6")
  isPublic    Boolean     @default(false)
  tags        String      @default("")
  category    String      @default("general")
  thumbnail   String?
  createdAt   DateTime    @default(now())
  updatedAt   DateTime
  NoteLink    NoteLink[]
  PdfFile     PdfFile[]
  VideoNote   VideoNote[]

  @@index([createdAt, category])
  @@index([isPublic])
  @@index([category])
  @@index([createdAt])
}

model PdfFile {
  id           String   @id
  notebookId   String
  filename     String
  originalName String
  size         Int
  mimeType     String
  path         String
  uploadedAt   DateTime @default(now())
  updatedAt    DateTime
  Notebook     Notebook @relation(fields: [notebookId], references: [id], onDelete: Cascade)

  @@index([notebookId])
}

model Post {
  id        String   @id
  title     String
  content   String?
  published Boolean  @default(false)
  authorId  String
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model User {
  id        String   @id
  email     String   @unique
  name      String?
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model VideoNote {
  id          String     @id
  videoId     String
  title       String
  channelName String
  thumbnail   String
  note        String
  fontSize    Int        @default(16)
  startTime   Int?
  endTime     Int?
  isClip      Boolean    @default(false)
  createdAt   DateTime   @default(now())
  updatedAt   DateTime
  notebookId  String?
  NoteLink    NoteLink[]
  Notebook    Notebook?  @relation(fields: [notebookId], references: [id])

  @@index([isClip])
  @@index([channelName])
  @@index([notebookId])
  @@index([createdAt])
  @@index([videoId])
  @@index([notebookId, createdAt])
}

model VideoPlaybackPosition {
  id          String   @id
  videoId     String   @unique
  title       String
  channelName String
  thumbnail   String
  duration    Float
  currentTime Float    @default(0)
  lastWatched DateTime @default(now())
  updatedAt   DateTime

  @@index([channelName])
  @@index([videoId])
  @@index([lastWatched])
}

model WatchedVideo {
  id          String   @id
  videoId     String   @unique
  title       String
  channelName String
  thumbnail   String
  duration    String?
  viewCount   String?
  watchedAt   DateTime @default(now())
  updatedAt   DateTime

  @@index([watchedAt, channelName])
  @@index([videoId])
  @@index([channelName])
  @@index([watchedAt])
}

model WhitelistedItem {
  id                 String    @id
  itemId             String    @unique
  title              String
  type               String
  thumbnail          String?
  channelName        String?
  addedAt            DateTime  @default(now())
  updatedAt          DateTime
  expiresAt          DateTime?
  isChannelWhitelist Boolean   @default(false)
  priority           Int       @default(0)
  batchId            String?
  severity           String    @default("medium")
  source             String    @default("manual")
  reason             String?
  tags               String?
  metadata           String?
  matchCount         Int       @default(0)
  lastMatched        DateTime?
  isActive           Boolean   @default(true)

  @@unique([itemId, type])
  @@index([source])
  @@index([matchCount])
  @@index([lastMatched])
  @@index([addedAt])
  @@index([expiresAt])
  @@index([priority, isActive])
  @@index([severity, isActive])
  @@index([isChannelWhitelist, isActive])
  @@index([type, isActive])
  @@index([itemId])
}
